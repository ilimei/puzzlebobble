!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/puzzlebobble",n(n.s=2)}([function(t,e,n){
/*!
 * Name: tinyjs-plugin-ui
 * Description: Tiny.js UI plugin
 * Author: yiiqii
 * Version: v0.5.0
 */
!function(t){"use strict";var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},o=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},a=function t(){e(this,t),this.width=0,this.height=0,this.active={},this.textStyle={},this.roundRectBase64_black75="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3NpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxMzAyZGY2ZS02Y2FmLTQ5YTUtYTVkNS1jM2Q3ZTY1ZGY2YjUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzQwQzQ1MDRDMDRGMTFFN0FFOEE4Qzg3QzREMDc2RjkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzQwQzQ1MDNDMDRGMTFFN0FFOEE4Qzg3QzREMDc2RjkiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MTMwMmRmNmUtNmNhZi00OWE1LWE1ZDUtYzNkN2U2NWRmNmI1IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjEzMDJkZjZlLTZjYWYtNDlhNS1hNWQ1LWMzZDdlNjVkZjZiNSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PobBPigAAAEFSURBVHjarJXNCgFRGIaP42+j/GysEW6AcBH2UrgyK3EFlNzBhLLAEvlZ2GCPeD99o6HxO99bT02n09M08533uJR9PCDDJEEYnMAOLEAfDHntIS4bWRaUQVS9zxa0WH6P2/KsQQnUQEB9Du0pAB+YgsuzkGRF9XvSwAvGVmEOVNX/IekabDT/gIpyHnJ4NL9dREBIjrzm0ZBKhoQJQWGchEFBYYiEZ0HhbZj3gr4DCZeCwhkJB4LCAQkNbhGnIYehuYIaAkJyHM2zvAF+kPpT1gbd57aZcCX9Oug90LSrL1oYgRWIfdGJVLB10DFlrxrbvAJy3N4xS3nQh59zSxt2V8BVgAEA0AAwNCQbWm0AAAAASUVORK5CYII=",this.roundRectBase64_white="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjhBMkZEMEVCQkUxODExRTdBQ0IzRDUwNDhFRTNGQTg4IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjhBMkZEMEVDQkUxODExRTdBQ0IzRDUwNDhFRTNGQTg4Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OEEyRkQwRTlCRTE4MTFFN0FDQjNENTA0OEVFM0ZBODgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OEEyRkQwRUFCRTE4MTFFN0FDQjNENTA0OEVFM0ZBODgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5j8e8ZAAAA4UlEQVR42qyUXQqCQBRG1cD2UEFQq2gXVtaLq6hd6GstI6j2EQS9RlhQuIXyZfouXGH8K3TuB2cYh7kHZcZrK6WsirjAYyagB1LwBGewB0dey4eEBabgqv6H9syK9fpDB4SqeUKuLQnbyHRpTugr85DDsjHQAdzAwDLLC4wcDAsBGaUPlg5fDal49Ml3TIZCwgcJ35h0hYSpU3nbDULCRNCXkPAiKDyR8CAoPEhf7HF2KGuBt1uBj94cIoP/OKprX5sWsm1d+8qYN2iw/q8Gq+OCAOxADFIm5rWA95RqvwIMAKI2aIgZcds+AAAAAElFTkSuQmCC",this.blankBase64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM3RDMwODAzQUM4RTExRTc4MDNEQTZGQ0E2MjgxNEFEIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM3RDMwODA0QUM4RTExRTc4MDNEQTZGQ0E2MjgxNEFEIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MzdEMzA4MDFBQzhFMTFFNzgwM0RBNkZDQTYyODE0QUQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MzdEMzA4MDJBQzhFMTFFNzgwM0RBNkZDQTYyODE0QUQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5Iqam2AAAAEElEQVR42mL4//8/A0CAAQAI/AL+26JNFgAAAABJRU5ErkJggg=="},s=function(t){function n(t,i){e(this,n);var o=r(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return o.setting=new a,o.children=[],o.parent=null,o.stage=null,o.initialized=!1,o.dragInitialized=!1,o.dropInitialized=!1,o.dirty=!0,o.pixelPerfect=!0,o.setting.width=t||0,o.setting.height=i||0,o}return o(n,t),n}(Tiny.Container),l=function(t){function n(){e(this,n);var t=r(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.interactive=!0,t.on("pointerdown",(function(t){})),t.on("pointerup",(function(t){})),t.on("pointermove",(function(t){})),t.on("pointerupoutside",(function(t){})),t}return o(n,t),n}(s),u=function(t){function i(t){e(this,i);var n=r(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));Object.assign(n.setting,t);var o=n,a=n.setting.active,s=n.setting.text||"",l=n.setting.background,u=a.background,b=void 0;if(Tiny.isUndefined(l)&&(l=n.setting.blankBase64),Tiny.isString(l)){var c=Tiny.BaseTexture.from(l),h=new Tiny.Texture(c);l=new Tiny.Sprite(h),Tiny.BaseTexture.removeFromCache(c)}var f=l.texture,d=n.getOpacity(),y=n.getScale().x,p=n.getScale().y;if(Tiny.isString(u)){var g=Tiny.BaseTexture.from(u);b=new Tiny.Texture(g),Tiny.BaseTexture.removeFromCache(g)}n.addChild(l),Tiny.isString(s)&&(s=new Tiny.Text(s,n.setting.textStyle)),n.addChild(s),l.texture.on("update",(function(){n.updatePosition(),o.emit("rendered")})),n.text=s,n.background=l,n.buttonMode=!0;var v=function(){b&&(l.texture=f),a.opacity&&o.setOpacity(d),a.scale&&o.setScale(y,p)},m=function(t){Tiny.isFunction(a.callback)&&a.callback(t)};return n.on("pointerdown",(function(t){if(b&&(l.texture=b),a.opacity&&o.setOpacity(a.opacity),a.scale){var e=a.scale;Tiny.isNumber(e)&&(e={scaleX:e,scaleY:e}),o.setScale(e.scaleX,e.scaleY)}})),n.on("pointerup",v),n.on("pointermove",(function(t){})),n.on("pointerupoutside",v),Tiny.isMobile.any&&Tiny.config.viewTouched||n.on("click",m),n.on("tap",m),n}return o(i,t),n(i,[{key:"updatePosition",value:function(t){var e=void 0,n=void 0,i=~~this.setting.width,o=~~this.setting.height,r=t||this.setting.textPosition;this.background.width=i||this.background.texture.width,this.background.height=o||this.background.texture.height;var a=this.background.width-this.text.width,s=this.background.height-this.text.height;switch(r){case 1:e=0,n=0;break;case 2:e=a/2,n=0;break;case 3:e=a,n=0;break;case 4:e=0,n=s/2;break;case 6:e=a,n=s/2;break;case 7:e=0,n=s;break;case 8:e=a/2,n=s;break;case 9:e=a,n=s;break;default:e=a/2,n=s/2}this.text.setPosition(e,n)}},{key:"value",get:function(){return this.text.text},set:function(t){this.text&&(this.text.text=t,this.updatePosition())}}]),i}(l),b=function(t){function i(t){e(this,i);var n=r(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));Object.assign(n.setting,t);var o=n.setting.html,a=n.setting.defs;return n.sprite=null,n._parseHTML(o,a,!1),n}return o(i,t),n(i,[{key:"updateHTML",value:function(t,e){this._parseHTML(t,e,!0)}},{key:"_parseHTML",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments[2],i=this,o=c(t),r=~~this.setting.width||o.width,a=~~this.setting.height||o.height,s='\n    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+r+'" height="'+a+'">\n      <foreignObject width="100%" height="100%">\n        '+e+'\n        <div xmlns="http://www.w3.org/1999/xhtml">'+t+"</div>\n      </foreignObject>\n    </svg>\n    ",l=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),u=new FileReader;u.onload=function(){var t=Tiny.Texture.fromImage(this.result);n?i.sprite.texture=t:(i.sprite=new Tiny.Sprite(t),i.addChild(i.sprite)),i.sprite.texture.on("update",(function(){i.emit("rendered")}))},u.readAsDataURL(l)}}]),i}(s);function c(t){var e=document.createElement("template"),n=document.createElement("span");e.innerHTML=t,document.body.appendChild(n),e.content?n.appendChild(e.content,n.lastElementChild):n.insertAdjacentHTML("beforeend",t),n.style.position="absolute",n.style.zIndex="-1",n.style.display="block";var i,o,r,a=(o=void 0,(r=[(i=n).offsetWidth,i.offsetHeight])[0]||("none"===(o=i.style).display?(o.display="block",r=[i.offsetWidth,i.offsetHeight],o.display="none"):""===o.display&&(o.display="block",r=[i.offsetWidth,i.offsetHeight],o.display="")),r),s={width:a[0],height:a[1]};return n.parentNode.removeChild(n),s}var h=function(t){function a(t){e(this,a);var n=r(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return n.defaultSetting={text:"",width:0,height:0},n.settings=Object.assign({},n.defaultSetting,t||{}),n.render(),n}return o(a,t),n(a,[{key:"render",value:function(){var t=this.settings,e=t.text,n=t.width,o=t.height,r=(t.wordWrap,t.breakWords,t.wordWrapWidth,function(t,e){var n={};for(var i in t)e.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}(t,["text","width","height","wordWrap","breakWords","wordWrapWidth"])),a=i({wordWrap:!!n,breakWords:!!n,wordWrapWidth:n},r);if(this.text=new Tiny.Text(e,a),o&&n){var s=new Tiny.Graphics;s.lineStyle(0),s.beginFill(16777215),s.drawRect(0,0,n,o),s.endFill(),this.mask=s}this.addChild(this.text)}}]),a}(l),f=function(t){function i(t,n,o,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e(this,i);var l=r(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return l._gridTexture=t,l._debugDraw=!1,l._textures=[],l._gridSprites=[],l._targetWidth=n||0,l._targetHeight=o||0,l._textureOrigFrame=new Tiny.Rectangle(0,0,l._gridTexture.width,l._gridTexture.height),l._scale9Grid=null,l._overlapPadding=s,l._inited=!1,l.scale9Grid=a,l._gridTexture.baseTexture.hasLoaded?l._onGridTextureUpdate():l._gridTexture.once("update",l._onGridTextureUpdate,l),l}return o(i,t),n(i,[{key:"_onGridTextureUpdate",value:function(){this._init(),this._update()}},{key:"_init",value:function(){if(!this._inited){this._inited=!0;for(var t=0;t<9;t++){var e=new Tiny.Texture(this._gridTexture,new Tiny.Rectangle(0,0,this._gridTexture.width,this._gridTexture.height),new Tiny.Rectangle(0,0,this._gridTexture.width,this._gridTexture.height),null,0);this._textures.push(e);var n=new Tiny.Sprite(e);n.visible=!1,this._gridSprites.push(n),this.addChild(n)}}}},{key:"resize",value:function(t,e){this._targetWidth=t,this._targetHeight=e,this._update(t,e)}},{key:"_update",value:function(){if(this._gridTexture&&this._gridTexture.baseTexture.hasLoaded&&this._inited){(this.width<this._gridTexture.width||this.height<this._gridTexture.height)&&console.warn("九宫格尺寸设置异常，尺寸不能小于素材尺寸");for(var t=Math.max(this.width,this._gridTexture.width),e=Math.max(this.height,this._gridTexture.height),n=this._scale9Grid,i=n[0],o=Math.max(0,n[2]),r=Math.max(0,this._gridTexture.width-i-o),a=n[1],s=Math.max(0,n[3]),l=[i,o,r],u=[0,i,i+o],b=[a,s,Math.max(0,this._gridTexture.height-a-s)],c=[0,a,a+s],h=this.overlapPadding,f=0;f<3;f++)for(var d=0;d<3;d++){var y=3*f+d,p=this._gridSprites[y],g=new Tiny.Rectangle(u[d],c[f],l[d],b[f]);if(g.width>0&&g.height>0){var v=0===d||2===d?l[d]:Math.max(0,t-l[0]-l[2]),m=0===f||2===f?b[f]:Math.max(0,e-b[0]-b[2]),w=0===d?0:1===d?l[0]:Math.max(0,t-l[2]),T=0===f?0:1===f?b[0]:Math.max(0,e-b[2]);v>0&&m>0?(this._textures[y].frame=g,p.anchor.set(0,0),p.x=w-d*h,p.y=T-f*h,p.alpha=this._debugDraw?.1+.05*y:1,p.width=v,p.height=m,p.visible=!0):p.visible=!1}else p.visible=!1}this.emit("resize")}}},{key:"debug",get:function(){return this._debugDraw},set:function(t){this._debugDraw=t,this._update()}},{key:"scale9Grid",get:function(){return this._scale9Grid},set:function(t){if(t){var e="string"==typeof t?t.split(","):t;if(4!==e.length)return void console.error("error scale9Grid format",t);e=e.map((function(t){return parseFloat(t)})),this._scale9Grid=e}else this._scale9Grid=[0,0,0,0];this._update()}},{key:"width",get:function(){return this._targetWidth||this._gridTexture.width},set:function(t){this._targetWidth=t,this._update()}},{key:"height",get:function(){return this._targetHeight||this._gridTexture.height},set:function(t){this._targetHeight=t,this._update()}},{key:"overlapPadding",get:function(){return this._overlapPadding},set:function(t){this._overlapPadding=+t||0,this._update()}}]),i}(s),d=function(t){function i(t,n){e(this,i);var o=r(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return o.stage=t&&t.stage||null,o.buttonText=n||"关闭",o.DPI=Tiny.config.dpi,o.PADDING=40*o.DPI,o.CONTENT_FONTSIZE=16*o.DPI,o.BTN_FONTSIZE=14*o.DPI,o.MIN_HEIGHT=50*o.DPI,o.MAX_WIDTH=.8*Tiny.WIN_SIZE.width,o}return o(i,t),n(i,[{key:"render",value:function(t){this.removeChildren(0,this.children.length),this.label=this.drawLabel(t),this.roundRect=this.drawRoundRect(),this.btn=this.drawButton(),this.updatePosition()}},{key:"drawLabel",value:function(t){var e=new h({text:t,fill:"0x333333",fontSize:this.CONTENT_FONTSIZE,width:this.MAX_WIDTH-this.PADDING});return this.addChild(e),e}},{key:"drawRoundRect",value:function(){var t=this.getLocalBounds().height,e=t>this.MIN_HEIGHT&&t+this.PADDING||this.MIN_HEIGHT+this.PADDING,n=Tiny.BaseTexture.from(this.setting.roundRectBase64_white),i=new Tiny.Texture(n),o=new f(i,this.MAX_WIDTH,e,[10,10,1,1]);return Tiny.BaseTexture.removeFromCache(n),this.addChild(o),o}},{key:"drawButton",value:function(){var t=this,e=new u({text:this.buttonText,textStyle:{fill:"0x108EE9",fontSize:this.BTN_FONTSIZE},active:{opacity:.5,callback:function(){t.stage&&t.stage.removeChild(t),t.callback&&t.callback()}}});return this.addChild(e),e}},{key:"updatePosition",value:function(){var t=this.roundRect,e=t.width,n=t.height,i=Tiny.WIN_SIZE;this.btn.setPosition(this.MAX_WIDTH-this.btn.width,n-this.btn.height),this.label.setPosition(this.MAX_WIDTH/2-this.label.width/2,n/2-this.label.height/2-5*this.DPI),this.setChildIndex(this.label,1),this.setPosition(i.width/2-e/2,i.height/2-n/2)}},{key:"alert",value:function(t,e){this.stage&&(this.stage.removeChild(this),this.render(t),this.stage.addChild(this),this.callback=e)}}]),i}(l),y=function(t){function i(t,n){e(this,i);var o=r(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return o.stage=t&&t.stage||null,o.autoHideTime=n||2e3,o.DPI=Tiny.config.dpi,o.PADDING=20*o.DPI,o.CONTENT_FONTSIZE=16*o.DPI,o.MIN_HEIGHT=20*o.DPI,o.MAX_WIDTH=.4*Tiny.WIN_SIZE.width,o.MIN_WIDTH=.3*Tiny.WIN_SIZE.width,o.bindEvent(),o}return o(i,t),n(i,[{key:"bindEvent",value:function(){var t=this;this.on("pointerdown",(function(e){t.stage&&t.stage.removeChild(t)}))}},{key:"render",value:function(t){this.removeChildren(0,this.children.length),this.label=this.drawLabel(t),this.roundRect=this.drawRoundRect(),this.updatePosition()}},{key:"drawLabel",value:function(t){var e=new h({text:t,fill:"0xffffff",fontSize:this.CONTENT_FONTSIZE,width:this.MAX_WIDTH});return this.addChild(e),e}},{key:"drawRoundRect",value:function(){var t=this.getLocalBounds(),e=t.width,n=t.height,i=n>this.MIN_HEIGHT&&n+this.PADDING||this.MIN_HEIGHT+this.PADDING,o=this.PADDING;e>this.MAX_WIDTH?o+=this.MAX_WIDTH:e<this.MIN_WIDTH?o+=this.MIN_WIDTH:o+=e;var r=new f(Tiny.Sprite.fromImage(this.setting.roundRectBase64_black75).texture,o,i,[10,10,1,1],0);return this.addChild(r),r}},{key:"updatePosition",value:function(){var t=this.roundRect,e=t.width,n=t.height,i=Tiny.WIN_SIZE;this.label.setPosition(e/2-this.label.width/2,n/2-this.label.height/2),this.setChildIndex(this.label,1),this.setPosition(i.width/2-e/2,i.height/2-n/2)}},{key:"show",value:function(t){var e=this;if(this.stage){this.stage.removeChild(this),this.render(t),this.stage.addChild(this);var n=new Tiny.ticker.CountDown({duration:this.autoHideTime,times:1});n.on("complete",(function(t){e.stage.children.length&&e.stage.removeChild(e),n.destroy()})),n.start()}}}]),i}(l),p=function(){function t(n){e(this,t),this.matchup=n}return n(t,[{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tiny.Container,n=t.split(""),i=this.matchup,o=0;return n.forEach((function(t){var n=i[t];if(n){var r=new Tiny.Sprite(i[t]),a=n.width;r.setPositionX(o),o+=a,e.addChild(r)}})),this.container=e,e}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1];return e||(e=this.container?this.container:new Tiny.Container),e.removeChildren(),this.create.call(this,t,e),e}}]),t}(),g=function(){function t(n,i,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;e(this,t),this.texts=Array.apply(null,Array(r)).map((function(){return" "})),this.container=n,this.length=r,this.count=0,this.sprites=[],this.textInstance=new Tiny.Text(this.texts.join("\n"),i,o),this.textInstance.setPositionX(Tiny.WIN_SIZE.width),this.textInstance.renderable=!1,n.addChild(this.textInstance)}return n(t,[{key:"create",value:function(t){var e=this,n=this.count,i=this.length;if(n>i)throw new RangeError("你创建的个数已超过预设值："+i);this.count++,this.texts[n]=t;var o=this._generateTexture(t,n),r=new Tiny.Sprite(o);return this.sprites.push(r),this._update(),r.textIndex=n,r.updateText=function(t){e._updateText(t,r),e._update()},r}},{key:"_update",value:function(){this.sprites.forEach((function(t){t.texture._updateUvs()}))}},{key:"_generateTexture",value:function(t,e){var n=this.length,i=this.textInstance;i.text=this.texts.join("\n");var o=i.texture.baseTexture,r=i.width,a=i.height/n,s=a*e;return new Tiny.Texture(o,new Tiny.Rectangle(0,s,r,a))}},{key:"_updateText",value:function(t,e){var n=e.textIndex;this.texts[n]=t;var i=this._generateTexture(t,n);e.texture=i}}]),t}();
/**
   * ui - Tiny.js UI plugin
   *
   * @name        tinyjs-plugin-ui
   * @overview    Tiny.js UI plugin
   * @author      yiiqii
   * @license     MIT
   */
t.Button=u,t.DOM=b,t.Label=h,t.Alert=d,t.NinePatch=f,t.Toast=y,t.ImageNumber=p,t.TiledText=g,Object.defineProperty(t,"__esModule",{value:!0})}(e)},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var i=n(0);function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,"bg",void 0),r(this,"isPlaying",!1)}var e,n,i;return e=t,i=[{key:"getInstance",value:function(){return t._instance||(t._instance=new t),t._instance}}],(n=[{key:"playBg",value:function(){var t=Tiny.audio.manager.getAudio("bgMusic");t.loop=!0,this.bg=t,this.isPlaying=!0,t.play()}},{key:"stopBg",value:function(){this.isPlaying=!1,this.bg&&this.bg.stop()}},{key:"playByName",value:function(t){Tiny.audio.manager.getAudio(t).play()}},{key:"playReadyGo",value:function(){this.playByName("readyGo")}},{key:"playShot",value:function(){this.playByName("shot")}},{key:"playExplosion",value:function(){this.playByName("elimination")}},{key:"playExtraExplosion",value:function(){this.playByName("extraElimination")}},{key:"playWin",value:function(){this.playByName("win")}},{key:"playLose",value:function(){this.playByName("lose")}}])&&o(e.prototype,n),i&&o(e,i),t}();r(a,"_instance",void 0);var s={blue:{textures:["bobbles-blue-0","bobbles-blue-1","bobbles-blue-2","bobbles-blue-3","bobbles-blue-4","bobbles-blue-5","bobbles-blue-6","bobbles-blue-7","bobbles-blue-8","bobbles-blue-9","bobbles-blue-10","bobbles-blue-11","bobbles-blue-12","bobbles-blue-13","bobbles-blue-14","bobbles-blue-15","bobbles-blue-16"],idle:[0,1,2,3],slash:[4,5,6,7,8,9],explosion:[10,11,12,13,14,15,16]},gray:{textures:["bobbles-gray-0","bobbles-gray-1","bobbles-gray-2","bobbles-gray-3","bobbles-gray-4","bobbles-gray-5","bobbles-gray-6","bobbles-gray-7","bobbles-gray-8","bobbles-gray-9","bobbles-gray-10","bobbles-gray-11","bobbles-gray-12","bobbles-gray-13","bobbles-gray-14","bobbles-gray-15","bobbles-gray-16"],idle:[0,1,2,3],slash:[4,5,6,7,8,9],explosion:[10,11,12,13,14,15,16]},red:{textures:["bobbles-red-0","bobbles-red-1","bobbles-red-2","bobbles-red-3","bobbles-red-4","bobbles-red-5","bobbles-red-6","bobbles-red-7","bobbles-red-8","bobbles-red-9","bobbles-red-10","bobbles-red-11","bobbles-red-12","bobbles-red-13"],idle:[0],slash:[1,2,3,4,5,6],explosion:[7,8,9,10,11,12,13]},yellow:{textures:["bobbles-yellow-0","bobbles-yellow-1","bobbles-yellow-2","bobbles-yellow-3","bobbles-yellow-4","bobbles-yellow-5","bobbles-yellow-6","bobbles-yellow-7","bobbles-yellow-8","bobbles-yellow-9","bobbles-yellow-10","bobbles-yellow-11","bobbles-yellow-12","bobbles-yellow-13","bobbles-yellow-14","bobbles-yellow-15","bobbles-yellow-16"],idle:[0,1,2,3],slash:[4,5,6,7,8,9],explosion:[10,11,12,13,14,15,16]},green:{textures:["bobbles-green-0","bobbles-green-1","bobbles-green-2","bobbles-green-3","bobbles-green-4","bobbles-green-5","bobbles-green-6","bobbles-green-7","bobbles-green-8","bobbles-green-9","bobbles-green-10","bobbles-green-11","bobbles-green-12","bobbles-green-13","bobbles-green-14","bobbles-green-15","bobbles-green-16"],idle:[0,1,2,3],slash:[4,5,6,7,8,9],explosion:[10,11,12,13,14,15,16]},black:{textures:["bobbles-black-0","bobbles-black-1","bobbles-black-2","bobbles-black-3","bobbles-black-4","bobbles-black-5","bobbles-black-6","bobbles-black-7","bobbles-black-8","bobbles-black-9","bobbles-black-10","bobbles-black-11","bobbles-black-12","bobbles-black-13","bobbles-black-14","bobbles-black-15","bobbles-black-16"],idle:[0,1,2,3],slash:[4,5,6,7,8,9],explosion:[10,11,12,13,14,15,16]},orange:{textures:["bobbles-orange-0","bobbles-orange-1","bobbles-orange-2","bobbles-orange-3","bobbles-orange-4","bobbles-orange-5","bobbles-orange-6","bobbles-orange-7","bobbles-orange-8","bobbles-orange-9","bobbles-orange-10","bobbles-orange-11","bobbles-orange-12","bobbles-orange-13","bobbles-orange-14","bobbles-orange-15","bobbles-orange-16"],idle:[0,1,2,3],slash:[4,5,6,7,8,9],explosion:[10,11,12,13,14,15,16]},violet:{textures:["bobbles-violet-0","bobbles-violet-1","bobbles-violet-2","bobbles-violet-3","bobbles-violet-4","bobbles-violet-5","bobbles-violet-6","bobbles-violet-7","bobbles-violet-8","bobbles-violet-9","bobbles-violet-10","bobbles-violet-11","bobbles-violet-12","bobbles-violet-13","bobbles-violet-14","bobbles-violet-15","bobbles-violet-16"],idle:[0,1,2,3],slash:[4,5,6,7,8,9],explosion:[10,11,12,13,14,15,16]}},l={bubblun:{textures:["bubblun-bubblun-0","bubblun-bubblun-1","bubblun-bubblun-2","bubblun-bubblun-3","bubblun-bubblun-4","bubblun-bubblun-5","bubblun-bubblun-6","bubblun-bubblun-7","bubblun-bubblun-8","bubblun-bubblun-9","bubblun-bubblun-10","bubblun-bubblun-11"],idle:[0,1,2,3],moveRight:[4,5,6,7,8,9,10,11]}};function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,o,r=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var o=v(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return p(this,n)}}function p(t,e){if(e&&("object"===u(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return g(t)}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var w,T,A=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(r,Tiny.AnimatedSprite);var e,n,i,o=y(r);function r(){var t;h(this,r);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return m(g(t=o.call.apply(o,[this].concat(n))),"actionMap",new Map),t}return e=r,(n=[{key:"clone",value:function(){var t=new r(this.textures);return t.actionMap=this.actionMap,t}},{key:"addAction",value:function(t,e,n){this.actionMap.set(t,[e,n])}},{key:"playAction",value:function(t){var e=this;if(this.actionMap.has(t)){var n=b(this.actionMap.get(t),2),i=n[0],o=n[1];this.emit("actionstart",t,this),this.onFrameChange=function(n){(n>o||n<i)&&(e.emit("actionend",t,e),e.gotoAndPlay(i))},this.gotoAndPlay(i)}}}])&&f(e.prototype,n),i&&f(e,i),r}();function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=R(t);if(e){var o=R(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return k(this,n)}}function k(t,e){if(e&&("object"===I(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _(t)}function _(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function R(t){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function M(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t.IDLE="idle",t.SLASH="slash",t.EXPLOSION="explosion",t.MOVERIGHT="moveRight"}(w||(w={})),function(t){t[t.BLUE=0]="BLUE",t[t.GRAY=1]="GRAY",t[t.RED=2]="RED",t[t.YELLOW=3]="YELLOW",t[t.GREEN=4]="GREEN",t[t.BLACK=5]="BLACK",t[t.ORANGE=6]="ORANGE",t[t.VIOLET=7]="VIOLET"}(T||(T={}));var N=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&S(t,e)}(r,t);var e,n,i,o=O(r);function r(){var t;E(this,r);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return M(_(t=o.call.apply(o,[this].concat(n))),"gameX",void 0),M(_(t),"gameY",void 0),M(_(t),"color",void 0),t}return e=r,(n=[{key:"clone",value:function(){var t=new r(this.textures);return t.actionMap=this.actionMap,t.gameX=this.gameX,t.gameY=this.gameY,t.color=this.color,t}}])&&x(e.prototype,n),i&&x(e,i),r}(A);function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function B(t,e){return(B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=L(t);if(e){var o=L(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return G(this,n)}}function G(t,e){if(e&&("object"===P(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function L(t){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var C=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&B(t,e)}(n,t);var e=D(n);function n(){return j(this,n),e.apply(this,arguments)}return n}(A);function Z(t){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function W(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,o,r=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return H(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Y(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function U(t,e){return(U=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function F(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=z(t);if(e){var o=z(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Q(this,n)}}function Q(t,e){if(e&&("object"===Z(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return X(t)}function X(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function z(t){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function V(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var J=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&U(t,e)}(r,Tiny.Container);var e,n,i,o=F(r);function r(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),V(X(t=o.call(this)),"bobbleSprites",Object.keys(s).map((function(t,e){var n=s[t],i=new N(n.textures.map(Tiny.Texture.fromFrame));return i.addAction(w.IDLE,n[w.IDLE][0],n[w.IDLE][n[w.IDLE].length-1]),i.addAction(w.SLASH,n[w.SLASH][0],n[w.SLASH][n[w.SLASH].length-1]),i.addAction(w.EXPLOSION,n[w.EXPLOSION][0],n[w.EXPLOSION][n[w.EXPLOSION].length-1]),i.color=e,i}))),V(X(t),"bubblunSprites",Object.keys(l).map((function(t){var e=l[t],n=new C(e.textures.map(Tiny.Texture.fromFrame));return n.addAction(w.IDLE,e[w.IDLE][0],e[w.IDLE][e[w.IDLE].length-1]),n.addAction(w.MOVERIGHT,e[w.MOVERIGHT][0],e[w.MOVERIGHT][e[w.MOVERIGHT].length-1]),n}))),V(X(t),"arrow",void 0),V(X(t),"bubblun",void 0),V(X(t),"width",142),V(X(t),"height",176),V(X(t),"currentShot",void 0),V(X(t),"nextShot",void 0),V(X(t),"speed",160),V(X(t),"gameBobble",void 0),V(X(t),"bobbleList",void 0),V(X(t),"canShot",!0),t.bobbleList=[],t.gameBobble=new Array(8).fill(1).map((function(){return new Array(16).fill(null)})),t.initUI(),t.initBobbles(),t.initArrow(),t.initEvent(),window.Game=X(t),t}return e=r,i=[{key:"gameXYtoPosition",value:function(t,e){var n=e%2==1,i=28*Math.floor(e/2)+15,o=16*t+15;return n&&(i+=14,o+=8),[o,i]}},{key:"bobbleActionStart",value:function(t){w.EXPLOSION===t&&a.getInstance().playExplosion()}}],(n=[{key:"initUI",value:function(){var t=Tiny.Sprite.fromImage(Tiny.resources.bgPNG);t.setPosition(-1,-1);var e=Tiny.Sprite.fromFrame("tileset-bag");e.setPosition(0,this.height-4),this.addChild(t,e)}},{key:"initEvent",value:function(){this.on("shotend",this.handleShotEnd.bind(this)),this.on("bobbleadd",this.handleAddBobble.bind(this)),this.on("bobbleremove",this.handleBobbleRemove.bind(this)),this.on("win",this.handleWin.bind(this)),this.on("lose",this.handleLose.bind(this))}},{key:"initBobbles",value:function(){for(var t=0;t<2;t++)for(var e=t%2==1?7:8,n=0;n<e;n++){var i=Math.floor(8*Math.random()),o=this.createBobbles(i),a=W(r.gameXYtoPosition(n,t),2),s=a[0],l=a[1];o.gameX=n,o.gameY=t,this.gameBobble[n][t]=o,this.bobbleList.push(o),o.setPosition(s,l),this.addChild(o)}}},{key:"initArrow",value:function(){var t=new Tiny.Sprite(Tiny.Texture.fromFrame("tileset-arrow"));t.setAnchor(.5),t.setPosition(this.width/2,168),this.arrow=t,this.bubblun=this.bubblunSprites[0],this.bubblun.animationSpeed=.2,this.bubblun.setAnchor(.5),this.bubblun.setPosition(56,this.height+6),this.bubblun.playAction(w.IDLE),this.bubblun.on("actionend",this.bobbleActionEnd.bind(this));var e=this.createBobbles(T.BLUE);this.currentShot=e,e.setPosition(this.width/2,168),this.addChild(t,this.bubblun,e),this.genNext()}},{key:"genNext",value:function(){var t=this.bobbleList.map((function(t){return null==t?void 0:t.color})).filter((function(t){return!isNaN(t)})),e=this.createBobbles(t[Math.floor(Math.random()*t.length)]);this.nextShot=e,e.setPosition(40,this.height+12),this.addChild(this.nextShot)}},{key:"setDist",value:function(t,e){var n=t-this.arrow.getGlobalPosition().x,i=e-this.arrow.getGlobalPosition().y,o=Math.atan2(i,n)+Math.PI/2;this.currentShot&&this.currentShot.setRotation(o),this.arrow.setRotation(o)}},{key:"replaceShot",value:function(t){this.currentShot&&this.removeChild(this.currentShot);var e=this.createBobbles(t);this.currentShot=e,e.setPosition(this.width/2,168),this.addChild(this.currentShot)}},{key:"shot",value:function(t,e){if(this.currentShot&&this.canShot){var n=t-this.arrow.getGlobalPosition().x,i=e-this.arrow.getGlobalPosition().y,o=Math.atan2(i,n)+Math.PI/2;0===o&&(o=.001),this.arrow.setRotation(o),a.getInstance().playShot();var r=this.currentShot;this.currentShot=null,this.shotMove(r,o)}}},{key:"shotMove",value:function(t,e){var n=this,i=t.position,o=i.x,r=i.y,a=e>0?this.width-15:15,s=r-Math.tan(Math.PI/2-e)*(a-o);console.info(a);var l=Math.floor(Math.sqrt(Math.pow(a-o,2)+Math.pow(s-r,2))),u=Tiny.MoveTo(l/this.speed*1e3,{x:a,y:s});u.onUpdate=function(e,i){u._onUpdate.call(u,e,i),n.collision(t,u)},u.onComplete=function(){n.shotMove(t,-e),console.info("complete")},t.runAction(u)}},{key:"collision",value:function(t,e){for(var n=Number.MAX_VALUE,i=null,o=0;o<16;o++)for(var a=0;a<8;a++)if(this.gameBobble[a]&&this.gameBobble[a][o]){var s=this.gameBobble[a][o],l=Math.sqrt(Math.pow(s.position.x-t.position.x,2)+Math.pow(s.position.y-t.position.y,2));l<=14&&l<n&&(n=l,i=s)}if(i){var u=W(this.getNextPostion(i.gameX,i.gameY,t),4),b=u[0],c=u[1],h=u[2],f=u[3];t.gameX=b,t.gameY=c,this.gameBobble[b][c]=t,this.emit("bobbleadd",t),t.setPosition(h,f),t.setRotation(0),e.stop(),t.playAction(w.SLASH),this.shakeBobble(b,c),this.emit("shotend",t,i)}else if(t.position.y<15){console.info("collision bar");var d=Math.floor((t.position.x-7)/16),y=W(r.gameXYtoPosition(d,0),2),p=y[0],g=y[1];t.gameX=d,t.gameY=0,this.gameBobble[d][0]=t,this.emit("bobbleadd",t),t.setPosition(p,g),t.setRotation(0),e.stop(),t.playAction(w.SLASH),this.shakeBobble(d,0),this.emit("shotend",t,null)}}},{key:"getNextPostion",value:function(t,e,n){var i=this,o=[[t-1,e],[t+1,e],[t,e+1],[t,e-1]];e%2==1?(o.push([t+1,e+1]),o.push([t+1,e-1])):(o.push([t-1,e+1]),o.push([t-1,e-1]));var a=Number.MAX_VALUE,s=null;return o.forEach((function(t){var e=W(t,2),o=e[0],l=e[1];if(!(o<0||l<0||l%2==1&&7===o||i.gameBobble[o]&&i.gameBobble[o][l])){var u=W(r.gameXYtoPosition(o,l),2),b=u[0],c=u[1],h=Math.sqrt(Math.pow(b-n.position.x,2)+Math.pow(c-n.position.y,2));h<a&&(a=h,s=[o,l,b,c])}})),s}},{key:"shakeBobble",value:function(t,e){for(var n=e%2==1,i=0;i<2;i++)for(var o=0;o<2;o++){var r=Math.max(Math.min(7,t+i+(n?0:-1)),0),a=Math.max(e-o,0);this.gameBobble[r]&&this.gameBobble[r][a]&&this.gameBobble[r][a].runAction(Tiny.Back(Tiny.MoveBy(100,Tiny.point(1,-1))))}}},{key:"createBobbles",value:function(t){var e=this.bobbleSprites[t].clone();return e.animationSpeed=.2,e.setAnchor(.5),e.on("actionstart",r.bobbleActionStart),e.on("actionend",this.bobbleActionEnd.bind(this)),e.playAction(w.IDLE),e}},{key:"findExplosion",value:function(t){var e=this,n={},i={},o=[],r=[],s=20;!function r(a,l){var u="".concat(a,",").concat(l);if(!n[u]&&(n[u]=!0,e.gameBobble[a]&&e.gameBobble[a][l]&&e.gameBobble[a][l].color===t.color)){l<s&&(s=l);var b=l%2==1?0:-1;o.push(e.gameBobble[a][l]),i[u]=!0,r(a-1,l),r(a+1,l);for(var c=0;c<2;c++)r(a+c+b,l-1),r(a+c+b,l+1)}}(t.gameX,t.gameY);var l={},u=function t(n,o){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,a="".concat(n,",").concat(o);if(null!=l[a])return l[a];if(i[a])return l[a]=!0,!0;if(!e.gameBobble[n]||!e.gameBobble[n][o])return l[a]=!0,!0;if(0===o)return l[a]=!1,!1;if(o%2==1){if(!t(n,o-1)||!t(n+1,o-1))return l[a]=!1,!1}else if(!t(n,o-1)||!t(n-1,o-1))return l[a]=!1,!1;return(n-1==r||t(n-1,o,n))&&!(n+1!=r&&!t(n+1,o,n))||(l[a]=!1,!1)};o.length>=3&&(function(){for(var t=Math.max(s,1);t<20;t++)for(var n=0;n<8;n++)e.gameBobble[n]&&e.gameBobble[n][t]&&u(n,t)&&!i["".concat(n,",").concat(t)]&&r.push(e.gameBobble[n][t])}(),r.forEach((function(t){var n=Tiny.MoveBy(500,{x:0,y:200});e.gameBobble[t.gameX][t.gameY]=null,n.onComplete=e.handleDropEnd.bind(e,t),t.runAction(n)})),o.forEach((function(t){return t.playAction(w.EXPLOSION)})),o.length+r.length>=4&&a.getInstance().playExtraExplosion())}},{key:"bobbleActionEnd",value:function(t,e){w.IDLE!==t&&e.playAction(w.IDLE),w.EXPLOSION===t&&(this.gameBobble[e.gameX][e.gameY]=null,this.emit("bobbleremove",e),this.removeChild(e))}},{key:"handleShotEnd",value:function(t){var e=this;t.gameY>9&&this.emit("lose"),this.bubblun.playAction(w.MOVERIGHT);var n=Tiny.MoveTo(200,new Tiny.Point(this.width/2,168));n.onComplete=function(){e.currentShot=e.nextShot,e.genNext()},this.nextShot.runAction(n),this.findExplosion(t)}},{key:"handleDropEnd",value:function(t){this.emit("bobbleremove",t),this.removeChild(t)}},{key:"handleAddBobble",value:function(t){this.bobbleList.indexOf(t)<0&&this.bobbleList.push(t)}},{key:"handleBobbleRemove",value:function(t){var e=this.bobbleList.indexOf(t);e>=0&&this.bobbleList.splice(e,1),0===this.bobbleList.length&&this.emit("win")}},{key:"handleWin",value:function(){this.canShot=!1,a.getInstance().stopBg(),a.getInstance().playWin();var t=Tiny.Sprite.fromFrame("tileset-win");t.setAnchor(.5),t.setPosition(this.width/2,this.height/2),this.addChild(t)}},{key:"handleLose",value:function(){this.canShot=!1,a.getInstance().stopBg(),a.getInstance().playLose();var t=Tiny.Sprite.fromFrame("tileset-lose");t.setAnchor(.5),t.setPosition(this.width/2,this.height/2),this.addChild(t)}},{key:"printBobbles",value:function(){for(var t=0;t<10;t++){var e="".concat(t,","),n=8;t%2==1&&(e+=" ",n=7);for(var i=0;i<n;i++)e+=this.gameBobble[i]&&this.gameBobble[i][t]?"1 ":"0 ";console.info(e)}}}])&&Y(e.prototype,n),i&&Y(e,i),r}();function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q(t,e){return(q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=et(t);if(e){var o=et(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return tt(this,n)}}function tt(t,e){if(e&&("object"===K(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function et(t){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var nt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&q(t,e)}(n,Tiny.Container);var e=$(n);function n(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),t=e.call(this);var i=Tiny.WIN_SIZE,o=i.width,r=(i.height,new J),a=o/r.width;return r.setScale(a),r.setPosition(0,40),t.addChild(r),t.setEventEnabled(!0),t.on("pointermove",(function(t){var e=t.data.global,n=e.x,i=e.y;r.setDist(n,i)})),t.on("pointerup",(function(t){var e=t.data.global,n=e.x,i=e.y;console.info("touchend"),r.shot(n,i)})),document.body.addEventListener("keydown",(function(t){isNaN(+t.key)||r.replaceShot(+t.key)})),t}return n}();function it(t){return(it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ot(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function rt(t,e){return(rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function at(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=ut(t);if(e){var o=ut(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return st(this,n)}}function st(t,e){if(e&&("object"===it(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return lt(t)}function lt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ut(t){return(ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var bt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&rt(t,e)}(s,Tiny.Container);var e,n,o,r=at(s);function s(){var t,e,n,o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),t=r.call(this),e=lt(t),o=void 0,(n="logo")in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o;var a=Tiny.WIN_SIZE,l=a.width,u=a.height;t.logo=Tiny.Sprite.fromImage(Tiny.resources.logoPNG),t.logo.setAnchor(.5,0),t.logo.setPosition(l/2,40);var b=new i.Button({background:Tiny.Sprite.fromFrame("tileset-vendor-start.png"),active:{scale:1.4,callback:t.onReady}});return b.setPivot(b.width/2,b.height/2),b.setPosition(l/2,u-260),t.addChild(t.logo,b),t.on("transitionend",(function(){this.startAction()})),t}return e=s,(n=[{key:"onReady",value:function(){a.getInstance().isPlaying||(a.getInstance().playReadyGo(),a.getInstance().playBg(),Tiny.app.replaceScene(new nt,"SlideInB",800))}},{key:"startAction",value:function(){var t=Tiny.WIN_SIZE,e=t.width,n=t.height,i=Tiny.MoveTo(1e3,Tiny.point(e/2,n/2));i.setEasing(Tiny.TWEEN.Easing.Exponential.Out),this.logo.runAction(Tiny.RepeatForever(Tiny.Back(i),1200))}}])&&ot(e.prototype,n),o&&ot(e,o),s}(),ct={bgMusic:"res/sounds/SinglePlayerMusic.ogg",readyGo:"res/sounds/Reagy!Go!.ogg",elimination:"res/sounds/BallsElimination.ogg",extraElimination:"res/sounds/BallsScore.ogg",shot:"res/sounds/BubbleShot.ogg",lose:"res/sounds/Game_Over.ogg",win:"res/sounds/Continue.ogg"},ht={logoPNG:"res/images/Tiny.js.png",bgPNG:"res/images/bg.png",tilesetVendorJSON:"res/images/tilesets/tileset-vendor.json",playerJSON:"res/images/tilesets/tileset-player.json",bobblesJSON:"res/images/tilesets/tileset-bobbles.json",bubblunJSON:"res/images/tilesets/tileset-bubblun.json",audios:Object.keys(ct).map((function(t){return{name:t,url:ct[t]}}))};n(1),Tiny.app=new Tiny.Application({showFPS:!0,referWidth:375,dpi:2,renderOptions:{backgroundColor:12303291}}),{init:function(){console.log("init"),Tiny.resources=ht,this.resourceLoad()},resourceLoad:function(){var t=document.getElementById("progress"),e=document.getElementById("percent");Tiny.Loader.run({resources:Object.values(ht).flat(1),onProgress:function(n,i){var o=~~n;e.innerHTML="".concat(o,"%"),t.style.width="".concat(o,"%")},onAllComplete:function(){var n=document.body;n.removeChild(e),n.removeChild(t.parentNode);var i=new bt;Tiny.app.run(i),i.emit("transitionend")}})}}.init(),document.addEventListener("pause",(function(t){Tiny.app.pause()}),!1),document.addEventListener("resume",(function(t){Tiny.app.resume()}),!1)}]);